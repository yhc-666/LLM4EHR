Epoch 0:   0%|                                                        | 0/2896 [00:00<?, ?it/s]/home/ubuntu/hcy50662/LLM4EHR/src/data/collate.py:35: UserWarning: Creating a tensor from a list of numpy.ndarrays is extremely slow. Please consider converting the list to a single numpy.ndarray with numpy.array() before converting to a tensor. (Triggered internally at ./torch/csrc/utils/tensor_new.cpp:254.)
  labels_tensor = torch.tensor(labels, dtype=torch.float32)
Input ids are automatically padded to be a multiple of `config.attention_window`: 512
Epoch 0: 100%|███████████████████████████████| 2896/2896 [1:33:00<00:00,  1.93s/it, loss=0.551]
Validation: 100%|████████████████████████████████████████████| 635/635 [06:55<00:00,  1.53it/s]
{'macro_AUROC': '0.5395', 'macro_AUPRC': '0.1805', 'micro_F1': '0.2279', 'macro_F1': '0.0765'}
Epoch 1: 100%|███████████████████████████████| 2896/2896 [1:43:01<00:00,  2.13s/it, loss=0.397]
Validation: 100%|████████████████████████████████████████████| 635/635 [06:54<00:00,  1.53it/s]
{'macro_AUROC': '0.5480', 'macro_AUPRC': '0.1849', 'micro_F1': '0.0313', 'macro_F1': '0.0233'}
Epoch 2: 100%|███████████████████████████████| 2896/2896 [1:43:12<00:00,  2.14s/it, loss=0.359]
Validation: 100%|████████████████████████████████████████████| 635/635 [06:54<00:00,  1.53it/s]
{'macro_AUROC': '0.5679', 'macro_AUPRC': '0.1977', 'micro_F1': '0.0001', 'macro_F1': '0.0000'}
Epoch 3: 100%|███████████████████████████████| 2896/2896 [1:42:57<00:00,  2.13s/it, loss=0.436]
Validation: 100%|████████████████████████████████████████████| 635/635 [06:53<00:00,  1.53it/s]
{'macro_AUROC': '0.5955', 'macro_AUPRC': '0.2171', 'micro_F1': '0.0001', 'macro_F1': '0.0000'}
Epoch 4: 100%|███████████████████████████████| 2896/2896 [1:43:08<00:00,  2.14s/it, loss=0.246]
Validation: 100%|████████████████████████████████████████████| 635/635 [02:51<00:00,  3.71it/s]
{'macro_AUROC': '0.6562', 'macro_AUPRC': '0.2680', 'micro_F1': '0.0116', 'macro_F1': '0.0055'}
Epoch 5: 100%|██████████████████████████████████| 2896/2896 [24:53<00:00,  1.94it/s, loss=0.41]
Validation: 100%|████████████████████████████████████████████| 635/635 [01:13<00:00,  8.61it/s]
{'macro_AUROC': '0.7392', 'macro_AUPRC': '0.3705', 'micro_F1': '0.2060', 'macro_F1': '0.1071'}
Epoch 6: 100%|█████████████████████████████████| 2896/2896 [24:11<00:00,  2.00it/s, loss=0.388]
Validation: 100%|████████████████████████████████████████████| 635/635 [01:13<00:00,  8.61it/s]
{'macro_AUROC': '0.7571', 'macro_AUPRC': '0.4081', 'micro_F1': '0.2835', 'macro_F1': '0.1745'}
Epoch 7: 100%|█████████████████████████████████| 2896/2896 [24:15<00:00,  1.99it/s, loss=0.228]
Validation: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████| 635/635 [01:13<00:00,  8.61it/s]
{'macro_AUROC': '0.7672', 'macro_AUPRC': '0.4300', 'micro_F1': '0.3159', 'macro_F1': '0.2075'}
Epoch 8: 100%|████████████████████████████████████████████████████████████████████████████████████████████| 2896/2896 [24:12<00:00,  1.99it/s, loss=0.266]
Validation: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████| 635/635 [01:13<00:00,  8.63it/s]
{'macro_AUROC': '0.7736', 'macro_AUPRC': '0.4444', 'micro_F1': '0.3386', 'macro_F1': '0.2378'}
Epoch 9: 100%|█████████████████████████████████████████████████████████████████████████████████████████████| 2896/2896 [24:10<00:00,  2.00it/s, loss=0.29]
Validation: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████| 635/635 [01:13<00:00,  8.61it/s]
{'macro_AUROC': '0.7783', 'macro_AUPRC': '0.4543', 'micro_F1': '0.3572', 'macro_F1': '0.2611'}
Epoch 10: 100%|███████████████████████████████████████████████████████████████████████████████████████████| 2896/2896 [24:12<00:00,  1.99it/s, loss=0.342]
Validation: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████| 635/635 [01:13<00:00,  8.61it/s]
{'macro_AUROC': '0.7818', 'macro_AUPRC': '0.4611', 'micro_F1': '0.3712', 'macro_F1': '0.2782'}
Epoch 11: 100%|███████████████████████████████████████████████████████████████████████████████████████████| 2896/2896 [24:13<00:00,  1.99it/s, loss=0.254]
Validation: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████| 635/635 [01:13<00:00,  8.60it/s]
{'macro_AUROC': '0.7845', 'macro_AUPRC': '0.4663', 'micro_F1': '0.3788', 'macro_F1': '0.2897'}
Epoch 12: 100%|███████████████████████████████████████████████████████████████████████████████████████████| 2896/2896 [24:18<00:00,  1.99it/s, loss=0.316]
Validation: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████| 635/635 [01:13<00:00,  8.60it/s]
{'macro_AUROC': '0.7865', 'macro_AUPRC': '0.4702', 'micro_F1': '0.3868', 'macro_F1': '0.2957'}
Epoch 13: 100%|███████████████████████████████████████████████████████████████████████████████████████████| 2896/2896 [24:13<00:00,  1.99it/s, loss=0.354]
Validation: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████| 635/635 [01:13<00:00,  8.60it/s]
{'macro_AUROC': '0.7883', 'macro_AUPRC': '0.4735', 'micro_F1': '0.3905', 'macro_F1': '0.3054'}
Epoch 14: 100%|███████████████████████████████████████████████████████████████████████████████████████████| 2896/2896 [24:17<00:00,  1.99it/s, loss=0.348]
Validation: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████| 635/635 [01:13<00:00,  8.60it/s]
{'macro_AUROC': '0.7897', 'macro_AUPRC': '0.4763', 'micro_F1': '0.3990', 'macro_F1': '0.3152'}
Epoch 15: 100%|███████████████████████████████████████████████████████████████████████████████████████████| 2896/2896 [24:18<00:00,  1.98it/s, loss=0.354]
Validation: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████| 635/635 [01:13<00:00,  8.61it/s]
{'macro_AUROC': '0.7908', 'macro_AUPRC': '0.4785', 'micro_F1': '0.4050', 'macro_F1': '0.3222'}
Epoch 16: 100%|███████████████████████████████████████████████████████████████████████████████████████████| 2896/2896 [24:15<00:00,  1.99it/s, loss=0.512]
Validation: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████| 635/635 [01:13<00:00,  8.60it/s]
{'macro_AUROC': '0.7919', 'macro_AUPRC': '0.4803', 'micro_F1': '0.4029', 'macro_F1': '0.3227'}
Epoch 17: 100%|███████████████████████████████████████████████████████████████████████████████████████████| 2896/2896 [24:12<00:00,  1.99it/s, loss=0.357]
Validation: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████| 635/635 [01:13<00:00,  8.60it/s]
{'macro_AUROC': '0.7928', 'macro_AUPRC': '0.4821', 'micro_F1': '0.4093', 'macro_F1': '0.3305'}
Epoch 18: 100%|███████████████████████████████████████████████████████████████████████████████████████████| 2896/2896 [24:15<00:00,  1.99it/s, loss=0.326]
Validation: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████| 635/635 [01:13<00:00,  8.60it/s]
{'macro_AUROC': '0.7936', 'macro_AUPRC': '0.4835', 'micro_F1': '0.4108', 'macro_F1': '0.3306'}
Epoch 19: 100%|███████████████████████████████████████████████████████████████████████████████████████████| 2896/2896 [24:16<00:00,  1.99it/s, loss=0.274]
Validation: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████| 635/635 [01:13<00:00,  8.61it/s]
{'macro_AUROC': '0.7943', 'macro_AUPRC': '0.4848', 'micro_F1': '0.4133', 'macro_F1': '0.3350'}
Epoch 20: 100%|███████████████████████████████████████████████████████████████████████████████████████████| 2896/2896 [24:18<00:00,  1.99it/s, loss=0.325]
Validation: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████| 635/635 [01:13<00:00,  8.61it/s]
{'macro_AUROC': '0.7950', 'macro_AUPRC': '0.4861', 'micro_F1': '0.4184', 'macro_F1': '0.3415'}
Epoch 21: 100%|████████████████████████████████████████████████████████████████████████████████████████████| 2896/2896 [24:19<00:00,  1.98it/s, loss=0.27]
Validation: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████| 635/635 [01:13<00:00,  8.60it/s]
{'macro_AUROC': '0.7955', 'macro_AUPRC': '0.4870', 'micro_F1': '0.4175', 'macro_F1': '0.3411'}
Epoch 22: 100%|███████████████████████████████████████████████████████████████████████████████████████████| 2896/2896 [24:17<00:00,  1.99it/s, loss=0.664]
Validation: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████| 635/635 [01:13<00:00,  8.60it/s]
{'macro_AUROC': '0.7960', 'macro_AUPRC': '0.4881', 'micro_F1': '0.4218', 'macro_F1': '0.3449'}
Epoch 23: 100%|███████████████████████████████████████████████████████████████████████████████████████████| 2896/2896 [24:11<00:00,  2.00it/s, loss=0.232]
Validation: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████| 635/635 [01:13<00:00,  8.61it/s]
{'macro_AUROC': '0.7965', 'macro_AUPRC': '0.4889', 'micro_F1': '0.4206', 'macro_F1': '0.3453'}
Epoch 24: 100%|███████████████████████████████████████████████████████████████████████████████████████████| 2896/2896 [24:15<00:00,  1.99it/s, loss=0.392]
Validation: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████| 635/635 [01:13<00:00,  8.61it/s]
{'macro_AUROC': '0.7969', 'macro_AUPRC': '0.4897', 'micro_F1': '0.4231', 'macro_F1': '0.3496'}
Epoch 25: 100%|███████████████████████████████████████████████████████████████████████████████████████████| 2896/2896 [24:16<00:00,  1.99it/s, loss=0.198]
Validation: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████| 635/635 [01:13<00:00,  8.60it/s]
{'macro_AUROC': '0.7973', 'macro_AUPRC': '0.4904', 'micro_F1': '0.4245', 'macro_F1': '0.3523'}
Epoch 26: 100%|███████████████████████████████████████████████████████████████████████████████████████████| 2896/2896 [24:14<00:00,  1.99it/s, loss=0.361]
Validation: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████| 635/635 [01:13<00:00,  8.60it/s]
{'macro_AUROC': '0.7975', 'macro_AUPRC': '0.4910', 'micro_F1': '0.4259', 'macro_F1': '0.3532'}
Epoch 27: 100%|███████████████████████████████████████████████████████████████████████████████████████████| 2896/2896 [24:18<00:00,  1.99it/s, loss=0.318]
Validation: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████| 635/635 [01:13<00:00,  8.60it/s]
{'macro_AUROC': '0.7978', 'macro_AUPRC': '0.4917', 'micro_F1': '0.4279', 'macro_F1': '0.3548'}
Epoch 28: 100%|███████████████████████████████████████████████████████████████████████████████████████████| 2896/2896 [24:12<00:00,  1.99it/s, loss=0.329]
Validation: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████| 635/635 [01:13<00:00,  8.60it/s]
{'macro_AUROC': '0.7981', 'macro_AUPRC': '0.4922', 'micro_F1': '0.4269', 'macro_F1': '0.3551'}
Epoch 29: 100%|███████████████████████████████████████████████████████████████████████████████████████████| 2896/2896 [24:15<00:00,  1.99it/s, loss=0.331]
Validation: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████| 635/635 [01:13<00:00,  8.61it/s]
{'macro_AUROC': '0.7984', 'macro_AUPRC': '0.4927', 'micro_F1': '0.4282', 'macro_F1': '0.3566'}
Epoch 30:  53%|████████████████████████████████████████████████▋                                          | 1548/2896 [12:59<11:19,  1.98it/s, loss=0.466]
Traceback (most recent call last):
  File "/usr/lib/python3.10/runpy.py", line 196, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/usr/lib/python3.10/runpy.py", line 86, in _run_code
    exec(code, run_globals)
  File "/home/ubuntu/hcy50662/LLM4EHR/src/train.py", line 148, in <module>
    main(args.config)
  File "/home/ubuntu/hcy50662/LLM4EHR/src/train.py", line 124, in main
    accelerator.backward(loss)
  File "/home/ubuntu/.local/lib/python3.10/site-packages/accelerate/accelerator.py", line 2473, in backward
    loss.backward(**kwargs)
  File "/usr/lib/python3/dist-packages/torch/_tensor.py", line 626, in backward
    torch.autograd.backward(
  File "/usr/lib/python3/dist-packages/torch/autograd/__init__.py", line 347, in backward
    _engine_run_backward(
  File "/usr/lib/python3/dist-packages/torch/autograd/graph.py", line 823, in _engine_run_backward
    return Variable._execution_engine.run_backward(  # Calls into the C++ engine to run the backward pass
KeyboardInterrupt
